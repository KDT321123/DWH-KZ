"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.setAppDefaults = exports.setDefaultTemplateSettings = void 0;
const odata_service_writer_1 = require("@sap-ux/odata-service-writer");
const read_pkg_up_1 = __importDefault(require("read-pkg-up"));
const types_1 = require("../types");
const templateAttributes_1 = require("./templateAttributes");
const defaultModelName = 'mainModel'; // UI5 default model name is '' but some floorplans require a named default model
/**
 * Updates the template settings to defaults if not provided.
 *
 * @param template - The template to be updated
 * @param odataVersion - may be used to determine the default properties set
 * @returns Updated template settings
 */
function setDefaultTemplateSettings(template, odataVersion) {
    const templateSettings = template.settings;
    if (template.type === types_1.TemplateType.AnalyticalListPage) {
        const alpSettings = template.settings;
        Object.assign(templateSettings, {
            tableType: alpSettings.tableType || types_1.TableType.ANALYTICAL // Overrides the UI5 default: ''
        });
        if (odataVersion === odata_service_writer_1.OdataVersion.v4) {
            const alpV4Settings = template.settings;
            Object.assign(templateSettings, {
                selectionMode: alpV4Settings.selectionMode || types_1.TableSelectionMode.NONE
            });
            return templateSettings;
        }
        if (odataVersion === odata_service_writer_1.OdataVersion.v2) {
            const alpSettingsv2 = template.settings;
            Object.assign(templateSettings, {
                multiSelect: alpSettingsv2.multiSelect,
                qualifier: alpSettingsv2.qualifier,
                autoHide: alpSettingsv2.autoHide,
                smartVariantManagement: alpSettingsv2.smartVariantManagement
            });
            return templateSettings;
        }
    }
    return templateSettings;
}
exports.setDefaultTemplateSettings = setDefaultTemplateSettings;
/**
 * Sets defaults for the specified Fiori elements application.
 *
 * @param feApp - Fiori elements application config
 * @returns Fiori elements app config with updated defaults for unspecified properties
 */
function setAppDefaults(feApp) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    // Add template information
    if (!((_a = feApp.app.sourceTemplate) === null || _a === void 0 ? void 0 : _a.version) || !((_b = feApp.app.sourceTemplate) === null || _b === void 0 ? void 0 : _b.id)) {
        const packageInfo = read_pkg_up_1.default.sync({ cwd: __dirname });
        feApp.app.sourceTemplate = {
            id: `${packageInfo === null || packageInfo === void 0 ? void 0 : packageInfo.packageJson.name}:${feApp.template.type}`,
            version: packageInfo === null || packageInfo === void 0 ? void 0 : packageInfo.packageJson.version,
            toolsId: (_c = feApp.app.sourceTemplate) === null || _c === void 0 ? void 0 : _c.toolsId
        };
    }
    // Generate base UI5 project
    feApp.app.baseComponent = feApp.app.baseComponent || templateAttributes_1.getBaseComponent(feApp.template.type, feApp.service.version);
    // Add ui5 libs for specified template and odata version
    // Dups will be removed by call to `generateUI5Project`
    feApp.ui5 = Object.assign(Object.assign({}, feApp.ui5), { ui5Libs: (_d = templateAttributes_1.getUi5Libs(feApp.template.type, feApp.service.version)) === null || _d === void 0 ? void 0 : _d.concat((_f = (_e = feApp.ui5) === null || _e === void 0 ? void 0 : _e.ui5Libs) !== null && _f !== void 0 ? _f : []) });
    if (!feApp.service.localAnnotationsName) {
        feApp.service.localAnnotationsName = 'annotation';
    }
    // OVP must use a named default model
    if (feApp.template.type === types_1.TemplateType.OverviewPage) {
        feApp.service.model = defaultModelName;
    }
    // minimum UI5 version depending on the template required
    feApp.ui5 = (_g = feApp.ui5) !== null && _g !== void 0 ? _g : {};
    if (!feApp.ui5.minUI5Version) {
        feApp.ui5.minUI5Version = (_h = feApp.ui5.version) !== null && _h !== void 0 ? _h : templateAttributes_1.TemplateTypeAttributes[feApp.template.type].minimumUi5Version[feApp.service.version];
    }
    return feApp;
}
exports.setAppDefaults = setAppDefaults;
//# sourceMappingURL=defaults.js.map